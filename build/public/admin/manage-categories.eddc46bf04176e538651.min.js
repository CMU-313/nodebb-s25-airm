"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[90479,99127,34271,69185,86198,1091,49897],{29195:(P,D,d)=>{var b,A;b=[d(17459),d(81335),d(65348),d(49897),d(10246),d(40027),d(29930)],A=function(w,S,x,m,f,a,s){f=f.default;const g={};let c=-1,y;g.init=function(){x.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(e){ajaxify.go("/admin/manage/categories"+(e.cid?"?cid="+e.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),g.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",g.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const e=$(this),i=e.attr("data-disable-cid"),l=e.parents('li[data-cid="'+i+'"]'),C=l.hasClass("disabled"),h=l.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();g.toggle([i].concat(h),!C)}),$(".categories").on("click",".toggle",function(){const e=$(this);e.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),e.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden");const i=e.closest("[data-cid]").find("> ul.has-more-categories");parseInt(i.attr("data-hasmore"),10)===1&&i.toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const e=$(this).attr("data-cid"),i=$(this).attr("data-order"),l=a.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+i+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const C=l.find("input").val();if(C&&e){const E={};E[e]={order:Math.max(1,parseInt(C,10))},m.put("/categories/"+e,E[e]).then(function(){ajaxify.refresh()}).catch(s.error)}else return!1}}}})}),$("#toggle-collapse-all").on("click",function(){const e=$(this),i=parseInt(e.attr("data-collapsed"),10)===1;t(i),e.attr("data-collapsed",i?0:1).translateText(i?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function t(e){const i=$(".categories .toggle");i.find("i").toggleClass("fa-chevron-down",e).toggleClass("fa-chevron-right",!e),i.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!e)}},g.throwCreateModal=function(){S.render("admin/partials/categories/create",{}).then(function(t){const e=a.dialog({title:"[[admin/manage/categories:alert.create]]",message:t,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:E}}}),i={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"};r();const l=x.init(e.find('#parentCidGroup [component="category-selector"]'),i),C=x.init(e.find('#cloneFromCidGroup [component="category-selector"]'),i);function E(){const p=$(".tag").map(function(){return $(this).text()}).get(),v=e.find("form").serializeObject();return v.description="",v.icon="fa-comments",v.uid=app.user.uid,v.parentCid=l.getSelectedCid(),v.cloneFromCid=C.getSelectedCid(),v.tagWhitelist=p,g.create(v),e.modal("hide"),!1}$("#cloneChildren").on("change",function(){const h=$(this),p=e.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');h.prop("checked")?(p.attr("disabled","disabled"),l.selectCategory(0)):p.removeAttr("disabled")}),e.find("form").on("submit",E)})},g.create=function(t){console.log("PAYLOAD"),console.log(t),m.post("/categories",t,function(e,i){if(console.log("DATA"),console.log(i),e)return s.error(e);s.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+i.cid)})},g.render=function(t){const e=$(".categories");!t||!t.length?w.translate("[[admin/manage/categories:alert.none-active]]",function(i){$("<div></div>").addClass("alert alert-info text-center").text(i).appendTo(e)}):(y={},o(t,e,{cid:0}))},g.toggle=function(t,e){const i=document.querySelector('.categories [data-cid="0"]');Promise.all(t.map(l=>m.put("/categories/"+l,{disabled:e?1:0}).then(()=>{const C=i.querySelector(`li[data-cid="${l}"]`);C.classList[e?"add":"remove"]("disabled"),$(C).find('li a[data-action="toggle"]').first().translateText(e?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(s.error)))};function u(t){c=t.to.dataset.cid}function n(t){const e=parseInt(c,10)!==-1;if(t.newIndex!=null&&parseInt(t.oldIndex,10)!==parseInt(t.newIndex,10)||e){const i=t.item.dataset.cid,l={},C=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(l[i]={order:C+t.newIndex+1},e){l[i].parentCid=c;const E=parseInt(t.from.getAttribute("data-cid"),10),h=parseInt(t.to.getAttribute("data-cid"),10);if(E!==h){const p=document.querySelector(`.categories li[data-cid="${h}"] .toggle`);if(p&&p.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${E}"] ul[data-cid] li[data-cid]`).length){const I=document.querySelector(`.categories li[data-cid="${E}"] .toggle`);I&&I.classList.toggle("invisible",!0)}t.item.dataset.parentCid=h}}c=-1,m.put("/categories/"+i,l[i]).catch(s.error)}}function r(){$("#tag-whitelist").tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0})}function o(t,e,i){let l=0;const C=i.cid;t.forEach(function(h,p,v){w.translate(h.name,function(I){h.name!==I&&(h.name=I),l+=1,l===v.length&&E()})}),t.length||E();function E(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:i.cid,categories:t,parentCategory:i},function(h){e.find(".category-row").length?e.find(".category-row").after(h):e.append(h),t.length||e.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let p=0,v=t.length;p<v;p+=1)o(t[p].children,$('li[data-cid="'+t[p].cid+'"]'),t[p]);y[C]=f.create($('ul[data-cid="'+C+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:u,onEnd:n})})}}return g}.apply(D,b),A!==void 0&&(P.exports=A)},49897:(P,D,d)=>{d.r(D),d.d(D,{del:()=>u,get:()=>a,head:()=>s,patch:()=>c,post:()=>g,put:()=>y});var b=d(91749),A=d.n(b),w=d(40027),S=d.n(w);const x=config.relative_path+"/api/v3";async function m(n,r){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:x+n.url,typeof r=="function"){f(n).then(o=>r(null,o),o=>r(o));return}try{return await f(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:t}=await(0,b.fire)("filter:admin.reauth",{url:"login"});return(0,w.confirm)("[[error:api.reauth-required]]",e=>{e&&ajaxify.go(t)})}throw o}}async function f(n){const{url:r}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,b.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(r,n),{headers:t}=o,e=t.get("content-type"),i=e&&e.startsWith("application/json");let l;if(n.method!=="HEAD"&&(i?l=await o.json():l=await o.text()),!o.ok)throw l?new Error(i?l.status.message:l):new Error(o.statusText);return i&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function a(n,r,o){return m({url:n+(r&&Object.keys(r).length?"?"+$.param(r):"")},o)}function s(n,r,o){return m({url:n+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},o)}function g(n,r,o){return m({url:n,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function c(n,r,o){return m({url:n,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function y(n,r,o){return m({url:n,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function u(n,r,o){return m({url:n,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}},96349:(P,D,d)=>{var b,A;b=[d(29930),d(89336),d(49897)],A=function(w,S,x){const m={};return m.init=function(f,a){let s=null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let g=[];Array.isArray(a.localCategories)&&(g=a.localCategories.map(r=>({...r}))),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const c=f.find('[component="category-selector-search"]');if(!c.length)return;const y=c.parent('[component="category/dropdown"]').length>0||c.parent('[component="category-selector"]').length>0;f.on("show.bs.dropdown",function(){y&&(f.find(".dropdown-toggle").css({visibility:"hidden"}),c.removeClass("hidden"),c.css({"z-index":f.find(".dropdown-toggle").css("z-index")+1}));function r(){const o=c.find("input").val();o.length>1||!o&&!s?u(o,function(t){s=a.cacheList&&(s||t),n(t)}):!o&&s&&n(s)}c.on("click",function(o){o.preventDefault(),o.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),f.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||c.find("input").focus()}),f.on("hide.bs.dropdown",function(){y&&(f.find(".dropdown-toggle").css({visibility:"inherit"}),c.addClass("hidden")),c.off("click"),c.find("input").off("keyup")});function u(r,o){x.get("/search/categories",{search:r,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(t,{categories:e}){if(t)return w.error(t);o(g.concat(e))})}function n(r){const o=a.selectedCids.map(String);r.forEach(function(t){t.selected=o.includes(String(t.cid))}),app.parseAndTranslate(a.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){f.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),f.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const e=S.Dropdown.getInstance(f.find(".dropdown-toggle").get(0));e&&e.update()})}},m}.apply(D,b),A!==void 0&&(P.exports=A)},65348:(P,D,d)=>{var b,A;b=[d(96349),d(40027),d(91749),d(17459)],A=function(w,S,x,m){const f={};return f.init=function(a,s){if(!a||!a.length)return;s=s||{};const g=s.onSelect||function(){};s.states=s.states||["watching","tracking","notwatching","ignoring"],s.template=s.template||"partials/category/selector-dropdown-left",x.fire("action:category.selector.options",{el:a,options:s}),w.init(a,s);const c={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const u=$(this);return u.hasClass("disabled")?!1:(c.selectCategory(u.attr("data-cid")),g(c.selectedCategory))});let y=c.el.find('[component="category-selector-selected"]').html();return m.translate(y,u=>{y=u}),c.selectCategory=function(u){const n=c.el.find('[data-cid="'+u+'"]');c.selectedCategory={cid:u,name:n.attr("data-name")},n.length?c.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):c.el.find('[component="category-selector-selected"]').html(y)},c.getSelectedCategory=function(){return c.selectedCategory},c.getSelectedCid=function(){return c.selectedCategory?c.selectedCategory.cid:0},s.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(s.template,{selectedCategory:s.selectedCategory},function(u){c.el.find('[component="category-selector-selected"]').html(u.find('[component="category-selector-selected"]').html())}),c},f.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(s){const g=S.dialog({title:a.title||"[[modules:composer.select-category]]",message:s,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:y}}}),c=f.init(g.find('[component="category-selector"]'),a);function y(u){return u.preventDefault(),c.selectedCategory&&(a.onSubmit(c.selectedCategory),g.modal("hide")),!1}a.openOnLoad&&g.on("shown.bs.modal",function(){g.find(".dropdown-toggle").dropdown("toggle")}),g.find("form").on("submit",y)})},f}.apply(D,b),A!==void 0&&(P.exports=A)}}]);
